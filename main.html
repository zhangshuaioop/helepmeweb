<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>后台管理系统</title>

    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/metisMenu.min.css" />
    <link rel="stylesheet" href="css/themes/prism.css" />
    <link rel="stylesheet" href="css/npm/animate.css" />
    <link rel="stylesheet" href="css/npm/noty/noty.css">
    <link rel="stylesheet" href="css/npm/noty/relax.css">

    <link rel="stylesheet" href="assets/css/app.css">

    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/metisMenu.min.js"></script>
    <script src="js/prismjs.js"></script>
    <script src="js/noty.js"></script>

    <script src="js/admin/common/common.js"></script>

</head>

<body style="overflow-x:hidden;  margin:0; padding:0;">


<header>
    <div class="navbar navbar-expand-md navbar-dark bg-dark box-shadow ">
        <div class="container d-flex justify-content-between row">
                <a href="main.html" class="navbar-brand d-flex align-items-center col-md-1">
                    <strong>首页</strong>
                </a>

            <button id="navbars" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault"
                    aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!--class="collapse navbar-collapse "-->
            <div class="collapse navbar-collapse " id="navbarsExampleDefault">
                <ul class="navbar-nav ml-auto ">

                    <!--<li class="nav-item dropdown">-->
                        <!--<a class="nav-link dropdown-toggle" href="#" id="dropdown01" data-toggle="dropdown" aria-haspopup="true"-->
                           <!--aria-expanded="false">Examples</a>-->
                        <!--<div class="dropdown-menu" aria-labelledby="dropdown01">-->
                            <!--<a class="dropdown-item" href="mm-vertical.html">Vertical Menu</a>-->
                            <!--<a class="dropdown-item" href="mm-horizontal.html">Horizontal Menu</a>-->
                            <!--<a class="dropdown-item" href="mm-folder.html">Folder View</a>-->
                            <!--<a class="dropdown-item" href="mm-vertical-hover.html">Hover Option For Desktop</a>-->
                            <!--<a class="dropdown-item" href="mm-animate.html">Animate</a>-->
                            <!--<a class="dropdown-item" href="mm-event.html">Event</a>-->
                            <!--<a class="dropdown-item" href="mm-event2.html">Event 2</a>-->
                            <!--<a class="dropdown-item" href="mm-dispose.html">Stop &amp; Start metisMenu</a>-->
                            <!--<a class="dropdown-item" href="mm-ajax.html">Ajax</a>-->
                            <!--<a class="dropdown-item" href="mm-faq.html">FAQ</a>-->
                            <!--<a class="dropdown-item" href="mm-bs-card.html">Bootstrap Card</a><a class="dropdown-item"-->
                                                                                                 <!--href="mm-docs.html">Docs</a>-->
                        <!--</div>-->
                    <!--</li>-->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="dropdown02" data-toggle="dropdown" aria-haspopup="true"
                           aria-expanded="false">设置</a>
                        <div class="dropdown-menu" aria-labelledby="dropdown02">
                            <a class="dropdown-item" href="javascript:void(0)" target="_blank" id="userName"></a>
                            <a class="dropdown-item" href="javascript:void(0)" onclick="logout()" target="_blank">退出</a>
                        </div>
                    </li>


                    <!--<li class="nav-item">-->
                        <!--<a class="nav-link" href="http://onokumus.com" target="_blank">onokumus</a>-->
                    <!--</li>-->
                </ul>
            </div>

        </div>
    </div>
</header>

    <link href="assets/css/mm-vertical.css" rel="stylesheet" type="text/css" />

    <div class="row" >
            <nav class="sidebar-nav col-md-2" id="navbarsExampleDefault">
                <ul class=" metismenu" id="menu1" style="text-align:center" >

                    <!--<li>-->
                        <!--<a class="has-arrow" href="#">-->
                            <!--<span ></span>-->
                            <!--账号管理-->
                        <!--</a>-->
                        <!--<ul>-->
                            <!--<li>-->
                                <!--<a href="list.html" target = "mframe">-->
                                    <!--<span ></span> 账号列表-->
                                <!--</a>-->
                            <!--</li>-->
                        <!--</ul>-->
                    <!--</li>-->

                    <!--<li>-->
                        <!--<a class="has-arrow" href="#">-->
                            <!--<span ></span>-->
                            <!--产品管理-->
                        <!--</a>-->
                        <!--<ul>-->
                            <!--<li>-->
                                <!--<a href="list.html" target = "mframe">-->
                                    <!--<span ></span> 产品列表-->
                                <!--</a>-->
                            <!--</li>-->
                        <!--</ul>-->
                    <!--</li>-->


                    <!--<li>-->
                        <!--<a class="has-arrow" href="#" aria-expanded="false">Menu 0</a>-->
                        <!--<ul>-->
                            <!--<li><a href="#">item 0.1</a></li>-->
                            <!--<li><a href="#">item 0.2</a></li>-->
                            <!--<li><a href="http://onokumus.com">onokumus</a></li>-->
                            <!--<li><a href="#">item 0.4</a></li>-->
                        <!--</ul>-->
                    <!--</li>-->
                    <!--<li id="removable">-->
                        <!--<a class="has-arrow" href="#" aria-expanded="false">Menu 1</a>-->
                        <!--<ul>-->
                            <!--<li><a href="#">item 1.1</a></li>-->
                            <!--<li><a href="#">item 1.2</a></li>-->
                            <!--<li class="mm-active">-->
                                <!--<a class="has-arrow" href="#" aria-expanded="true">Menu 1.3</a>-->
                                <!--<ul>-->
                                    <!--<li><a href="#">item 1.3.1</a></li>-->
                                    <!--<li><a href="#">item 1.3.2</a></li>-->
                                    <!--<li><a href="#">item 1.3.3</a></li>-->
                                    <!--<li><a href="#">item 1.3.4</a></li>-->
                                <!--</ul>-->
                            <!--</li>-->
                            <!--<li><a href="#">item 1.4</a></li>-->
                            <!--<li>-->
                                <!--<a class="has-arrow" href="#" aria-expanded="false">Menu 1.5</a>-->
                                <!--<ul>-->
                                    <!--<li><a href="#">item 1.5.1</a></li>-->
                                    <!--<li><a href="#">item 1.5.2</a></li>-->
                                    <!--<li><a href="#">item 1.5.3</a></li>-->
                                    <!--<li><a href="#">item 1.5.4</a></li>-->
                                <!--</ul>-->
                            <!--</li>-->
                        <!--</ul>-->
                    <!--</li>-->
                    <!--<li>-->
                        <!--<a class="has-arrow" href="#" aria-expanded="false">Menu 2</a>-->
                        <!--<ul>-->
                            <!--<li><a href="#">item 2.1</a></li>-->
                            <!--<li><a href="#">item 2.2</a></li>-->
                            <!--<li><a href="#">item 2.3</a></li>-->
                            <!--<li><a href="#">item 2.4</a></li>-->
                        <!--</ul>-->
                    <!--</li>-->
                </ul>
            </nav>


        <div class="col-md-10">
            <div class="card">
                <div class="card-body">





                    <!--<h5 class="card-title">Auto Collapse <small>default</small></h5>-->
                    <!--<pre>-->
                        <!--<code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">-->
  <!--$(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{-->

      <!--$(<span class="hljs-string">'#menu1'</span>).metisMenu();-->

  <!--});-->
<!--</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>-->
<!--</code>-->
                    <!--</pre>-->

                        <iframe name="mframe" id="mframe" src="index.html"  scrolling="no" frameborder="0" width="100%" height="1000px" ></iframe>

                </div>
            </div>



        </div>

    </div>


<!-- 模态框（成功） -->
<div class="modal fade" id="success" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
    <div class="modal-dialog" >
        <div id="myAlert" class="alert alert-success" style="text-align:center">
            <strong>成功</strong>
        </div>
    </div><!-- /.modal -->
</div>



<!-- 模态框（失败） -->
<div class="modal fade" id="erro" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
    <div class="modal-dialog" >
        <div id="myAlert" class="alert alert-danger" style="text-align:center" >
            <strong>失败</strong>
        </div>
    </div><!-- /.modal -->
</div>


<!-- 模态框（程序异常） -->
<div class="modal fade" id="exception" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
    <div class="modal-dialog" >
        <div id="myAlert" class="alert alert-danger" style="text-align:center" >
            <strong>程序异常</strong>
        </div>
    </div><!-- /.modal -->
</div>


    <script src="assets/js/mm-vertical.js" charset="utf-8"></script>


<script type="text/javascript">



    //获取到当前项目的名称
    // var contextPath = "/" + location.pathname.split("/")[1];


    //获取cookie
    var cookie = getCookie("token");

    var str = "";

    if(cookie!=null){
        $.ajax({
            url : apiUrl+"/sysAdmin/getAdminAuthority",
            type : "GET",
            headers: {'Authorization':cookie},
            dataType : "json",
            cache : false,
            success : function(data) {
                if (data.code==200) {
                    // document.title = data.data.product.name;

                    //权限
                    var sysAuthoritiesTree = data.data.sysAuthoritiesTree;

                    //用户信息
                    var sysAdmin = data.data.sysAdmin;



                    //一级
                    sysAuthoritiesTree.forEach(childrens=>{
                        str+=`<li>`+
                            `<a href="#" class="has-arrow"><span ></span>`+childrens.name+`</a><ul>`;
                        if(childrens.children != undefined && childrens.children.length>0){
                            children(childrens.children);
                        }

                        str+=`</ul>`+
                            `</li>`;
                    })
                    // console.log(str);
                    $("#menu1").metisMenu('dispose');
                    $("#menu1").append(str);
                    $("#menu1").metisMenu();

                    $("#userName").text(sysAdmin.nickName);

                }else{
                    erro();
                }

            },
            error : function() {

                exception();

            }
        });
    }else{
        window.location.href="login.html";
    }


    //子级
    function children(childrens) {

        if(childrens != undefined){
            childrens.forEach(it=>{
                if(it.children != undefined && it.children.length>0){
            // <a href="#" class="has-arrow"><span ></span>`+childrens.name+`</a><ul>
                    str+=`<li><a href="#" class="has-arrow"><span ></span>`+it.name+`</a><ul>`;
                    children(it.children);
                    str+=`</ul>`+
                        `</li>`;
                }else {
                    str+=`<li><a href="`+it.url+`.html" onclick="clickNavbars()" target = "mframe"><span ></span>`+it.name+`</a></li>`;
                }
            })
        }
    }


    // function changeFrameHeight(){
    //     var ifm= document.getElementById("myiframe");
    //     ifm.height=document.documentElement.clientHeight;

    // }

    // window.onresize=function(){
    //      changeFrameHeight();

    // }

    //默认展开样式
    var display =$('#navbars').css('display');
    if(display != 'none'){
        $("nav:first").addClass("collapse navbar-collapse");
    }


    // 触发折叠菜单
    function clickNavbars(){
        var display =$('#navbars').css('display');
        if(display != 'none'){
            $("#navbars").click();
        }

    }



    //退出删除cookie
    function  logout(){
        delCookie("token");
        window.location.reload()
    }



    //cookie
    function SetCookie(name,value)//两个参数，一个是cookie的名子，一个是值
    {
        var Days = 30; //此 cookie 将被保存 30 天
        var exp  = new Date();    //new Date("December 31, 9998");
        exp.setTime(exp.getTime() + Days*24*60*60*1000);
        document.cookie = name + "="+ escape (value) + ";expires=" + exp.toGMTString();
    }
    function getCookie(name)//取cookies函数
    {
        var arr = document.cookie.match(new RegExp("(^| )"+name+"=([^;]*)(;|$)"));
        if(arr != null) return unescape(arr[2]); return null;

    }
    function delCookie(name)//删除cookie
    {
        var exp = new Date();
        exp.setTime(exp.getTime() - 1);
        var cval=getCookie(name);
        if(cval!=null) document.cookie= name + "="+cval+";expires="+exp.toGMTString();
    }




    /**
     * 错误提示
     */
    function erro(){
        $('#erro').modal('show');
        window.setTimeout(function(){
            $('#erro').modal('hide');
        }, 1000);
    }

    /**
     * 成功提示
     */
    function success(){
        $('#success').modal('show');
        window.setTimeout(function(){
            $('#success').modal('hide');
        }, 1000);
    }

    /**
     * 异常提示
     */
    function exception(){
        $('#exception').modal('show');
        window.setTimeout(function(){
            $('#exception').modal('hide');
        }, 1000);
    }

</script>

</body>

</html>
